<!DOCTYPE html>
<html>
<head>
<title>Page Title</title>
</head>
<body>

<script src="./KBwasm.js"></script>
<script src="./KBcache.js"></script>
<script src="./KBstorage.js"></script>

<script>

    function stringFromUTF8Array(data)
    {
        const extraByteMap = [ 1, 1, 1, 1, 2, 2, 3, 0 ];
        var count = data.length;
        var str = "";

        for (var index = 0;index < count;)
        {
            var ch = data[index++];
            if (ch & 0x80)
            {
            var extra = extraByteMap[(ch >> 3) & 0x07];
            if (!(ch & 0x40) || !extra || ((index + extra) > count))
                return null;
            
            ch = ch & (0x3F >> extra);
            for (;extra > 0;extra -= 1)
            {
                var chx = data[index++];
                if ((chx & 0xC0) != 0x80)
                return null;
                
                ch = (ch << 6) | (chx & 0x3F);
            }
            }
            
            str += String.fromCharCode(ch);
        }

        return str;
    }

    let storage = new KBstorage("127.0.0.1", 3000);

    function EvaluateDE()
    {
        let de = document.getElementById("DE").value;

        storage.GetData(de).then( data => {
            document.getElementById("MIME").value = data.MIME;
            document.getElementById("size").value = data.size;
            document.getElementById("String value").value = stringFromUTF8Array(data);
        } );
    }

</script>

<form>
    Data Expression:<br>
    <input type="text" name="DataExpression" value='{ "cid" : "2CF24DBA5FB0A30E26E83B2AC5B9E29E1B161E5C1FA7425E73043362938B9824" }' size=100 id="DE"><br>
    <input type="button" onclick="EvaluateDE()" value="Evaluate Data Expression">
</form>

<br>Evaluation Result:<br>
<table style="width:100%">
    <tr>
      <th align="left">MIME</th>
      <th align="left">size</th>
      <th align="left">String value</th>
    </tr>
    <tr>
      <td><output id="MIME"></output></td>
      <td><output id="size"></output></td>
      <td><output id="String value"></output></td>
    </tr>
  </table>
</body>
</html>